generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["auth", "public"]
}

// ============================================================================
// PUBLIC SCHEMA MODELS (Your Application)
// ============================================================================

model Account {
  id        String   @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  User              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@schema("public")
}

model ActiveSession {
  id        String   @id @default(cuid())
  userId       String
  sessionToken String   @unique
  ipAddress    String?
  userAgent    String?
  deviceType   String?
  deviceName   String?
  location     String?
  lastActive   DateTime @default(now())
  expiresAt    DateTime
  createdAt    DateTime @default(now())
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([sessionToken])
  @@index([userId])
  @@index([userId, lastActive])
  @@schema("public")
}

model Activity {
  id        String   @id @default(cuid())
  userId    String
  type      String
  action    String
  metadata  Json?
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([userId])
  @@schema("public")
}

model AnalyticsEvent {
  id        String   @id @default(cuid())
  userId     String?
  event      String
  properties Json?
  createdAt  DateTime @default(now())

  @@index([createdAt])
  @@index([event])
  @@index([userId])
  @@schema("public")
}

model ApiEndpoint {
  id        String   @id @default(cuid())
  projectId      String
  name           String
  path           String
  method         String
  description    String?
  code           String
  requiresAuth   Boolean   @default(false)
  rateLimit      Int?
  responseType   String    @default("json")
  statusCode     Int       @default(200)
  usesDatabase   Boolean   @default(false)
  databaseTable  String?
  requestSchema  Json?
  responseSchema Json?
  tags           String[]  @default([])
  isActive       Boolean   @default(true)
  testsPassed    Boolean   @default(false)
  lastTested     DateTime?
  createdAt      DateTime  @default(now())
  updatedAt DateTime @updatedAt
  Project        Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, path, method])
  @@index([method])
  @@index([projectId])
  @@index([tags])
  @@schema("public")
}

model ApiTemplate {
  id        String   @id @default(cuid())
  name           String   @unique
  displayName    String
  description    String
  category       String
  icon           String
  tags           String[] @default([])
  template       String
  requiresAuth   Boolean  @default(false)
  usesDatabase   Boolean  @default(false)
  usesSendEmail  Boolean  @default(false)
  usesFileUpload Boolean  @default(false)
  configSchema   Json?
  isActive       Boolean  @default(true)
  usageCount     Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt @default(now())

  @@index([category])
  @@index([isActive])
  @@schema("public")
}

model CustomDomain {
  id        String   @id @default(cuid())
  projectId       String
  user_id         String
  domain          String    @unique
  status          String    @default("pending")
  verificationKey String?
  verifiedAt      DateTime?
  sslStatus       String    @default("pending")
  sslIssuedAt     DateTime?
  errorMessage    String?
  createdAt       DateTime  @default(now())
  updatedAt DateTime @updatedAt
  Project         Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  User            User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([domain])
  @@index([projectId])
  @@index([status])
  @@index([user_id])
  @@schema("public")
}

model DatabaseConnection {
  id        String   @id @default(cuid())
  userId             String
  projectId          String?         @unique
  name               String
  provider           String          @default("supabase")
  host               String?
  port               Int?
  database           String?
  username           String?
  password           String?
  supabaseUrl        String?
  supabaseAnonKey    String?
  supabaseServiceKey String?
  status             String          @default("connected")
  createdAt          DateTime        @default(now())
  updatedAt DateTime @updatedAt
  Project            Project?        @relation(fields: [projectId], references: [id], onDelete: Cascade)
  User               User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  DatabaseTable      DatabaseTable[]

  @@index([projectId])
  @@index([userId])
  @@schema("public")
}

model DatabaseTable {
  id        String   @id @default(cuid())
  databaseConnectionId String
  name                 String
  schema               Json
  createdAt            DateTime           @default(now())
  updatedAt DateTime @updatedAt
  DatabaseConnection   DatabaseConnection @relation(fields: [databaseConnectionId], references: [id], onDelete: Cascade)

  @@unique([databaseConnectionId, name])
  @@index([databaseConnectionId])
  @@schema("public")
}

model Deployment {
  id        String   @id @default(cuid())
  projectId       String
  userId          String
  platform        String   @default("vercel")
  deploymentUrl   String?
  deploymentId    String?
  vercelProjectId String?
  status          String   @default("pending")
  errorMessage    String?
  logs            String?
  createdAt       DateTime @default(now())
  updatedAt DateTime @updatedAt
  Project         Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  User            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([deploymentId])
  @@index([projectId])
  @@index([status])
  @@index([userId])
  @@schema("public")
}

model DripCampaign {
  id        String   @id @default(cuid())
  name           String
  description    String?
  status         String           @default("active")
  trigger        String
  createdAt      DateTime         @default(now())
  updatedAt      DateTime @updatedAt         @default(now())
  DripEmail      DripEmail[]
  DripEnrollment DripEnrollment[]

  @@index([status])
  @@index([trigger])
  @@schema("public")
}

model DripEmail {
  id        String   @id @default(cuid())
  campaignId   String
  name         String
  subject      String
  htmlContent  String
  delayDays    Int
  delayHours   Int          @default(0)
  order        Int          @default(0)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime @updatedAt     @default(now())
  DripCampaign DripCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([order])
  @@schema("public")
}

model DripEnrollment {
  id        String   @id @default(cuid())
  campaignId     String
  userEmail      String
  userId         String
  enrolledAt     DateTime     @default(now())
  completedAt    DateTime?
  unsubscribedAt DateTime?
  emailsSent     Json?
  DripCampaign   DripCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  User           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([enrolledAt])
  @@index([userEmail])
  @@index([userId])
  @@schema("public")
}

model EmailCampaign {
  id        String   @id @default(cuid())
  name              String
  subject           String
  previewText       String?
  htmlContent       String
  status            String      @default("draft")
  scheduledFor      DateTime?
  sentAt            DateTime?
  segment           String      @default("all")
  totalSent         Int         @default(0)
  totalOpened       Int         @default(0)
  totalClicked      Int         @default(0)
  totalBounced      Int         @default(0)
  totalUnsubscribed Int         @default(0)
  createdAt         DateTime    @default(now())
  updatedAt         DateTime @updatedAt    @default(now())
  createdBy         String
  User              User        @relation(fields: [createdBy], references: [id])
  EmailSend         EmailSend[]

  @@index([createdAt])
  @@index([scheduledFor])
  @@index([status])
  @@index([createdBy], map: "idx_emailcampaign_createdby")
  @@schema("public")
}

model EmailSend {
  id        String   @id @default(cuid())
  campaignId      String
  subscriberEmail String
  sentAt          DateTime      @default(now())
  openedAt        DateTime?
  clickedAt       DateTime?
  bouncedAt       DateTime?
  unsubscribedAt  DateTime?
  metadata        Json?
  user_id         String        @db.Uuid
  EmailCampaign   EmailCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([sentAt])
  @@index([subscriberEmail])
  @@index([user_id], map: "idx_emailsend_user_id")
  @@schema("public")
}

model EnvironmentVariable {
  id        String   @id @default(cuid())
  projectId   String
  key         String
  value       String
  description String?
  environment String   @default("all")
  createdAt   DateTime @default(now())
  updatedAt DateTime @updatedAt
  Project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, key, environment])
  @@index([key])
  @@index([projectId])
  @@schema("public")
}

model FailedLoginAttempt {
  id        String   @id @default(cuid())
  email       String
  ipAddress   String
  attempts    Int       @default(1)
  lockedUntil DateTime?
  createdAt   DateTime  @default(now())
  updatedAt DateTime @updatedAt
  lastAttempt DateTime  @default(now())
  userAgent   String?

  @@unique([email, ipAddress])
  @@index([email])
  @@index([ipAddress])
  @@index([lockedUntil])
  @@schema("public")
}

model Feedback {
  id        String   @id @default(cuid())
  userId    String
  type      String
  subject   String
  message   String
  status    String   @default("pending")
  priority  String   @default("medium")
  response  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([status])
  @@index([userId])
  @@schema("public")
}

model FormSubmission {
  id        String   @id @default(cuid())
  projectId   String
  userId      String
  type        String
  data        Json
  submittedAt DateTime @default(now())
  read        Boolean  @default(false)
  Project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  User        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([userId])
  @@schema("public")
}

model Generation {
  id        String   @id @default(cuid())
  userId     String
  createdAt  DateTime @default(now())
  code       String
  prompt     String
  type       String
  projectId  String?
  success    Boolean  @default(true)
  tokensUsed Int      @default(0)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([userId])
  @@schema("public")
}

model GenerationHistory {
  id        String   @id @default(cuid())
  userId     String
  projectId  String?
  prompt     String
  tokensUsed Int      @default(0)
  success    Boolean  @default(true)
  createdAt  DateTime @default(now())
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([userId])
  @@schema("public")
}

model NewsletterSubscriber {
  id        String   @id @default(cuid())
  email          String    @unique
  name           String?
  status         String    @default("active")
  source         String?
  subscribedAt   DateTime  @default(now())
  unsubscribedAt DateTime?
  preferences    Json?
  metadata       Json?
  userId         String?
  User           User?     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([subscribedAt])
  @@index([email], map: "idx_newslettersubscriber_email")
  @@index([userId], map: "idx_newslettersubscriber_userid")
  @@schema("public")
}

model Page {
  id        String   @id @default(cuid())
  projectId       String
  slug            String
  title           String
  description     String?
  content         String
  order           Int      @default(0)
  ogImage         String?
  createdAt       DateTime @default(now())
  updatedAt DateTime @updatedAt
  isHomepage      Boolean  @default(false)
  isPublished     Boolean  @default(true)
  metaDescription String?
  metaTitle       String?
  Project         Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, slug])
  @@index([projectId])
  @@schema("public")
}

model PasswordHistory {
  id        String   @id @default(cuid())
  userId         String
  hashedPassword String
  createdAt      DateTime @default(now())
  User           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@schema("public")
}

model Project {
  id        String   @id @default(cuid())
  userId              String
  name                String
  description         String?
  type                String
  code                String                @db.Text
  createdAt           DateTime              @default(now())
  updatedAt           DateTime @updatedAt              @default(now())
  downloads           Int                   @default(0)
  framework           String?
  isPublic            Boolean               @default(false)
  isPublished         Boolean               @default(false)
  publishedAt         DateTime?
  publicSlug          String?               @unique
  publicUrl           String?
  language            String?
  prompt              String?               @db.Text
  shareToken          String?               @unique
  tags                String[]              @default([])
  views               Int                   @default(0)
  multiPage           Boolean               @default(false)
  cssCode             String?               @db.Text
  errorMessage        String?
  htmlCode            String?               @db.Text
  jsCode              String?               @db.Text
  status              ProjectStatus         @default(DRAFT)
  
  // Additional fields from second Project model
  html                String?               @db.Text
  css                 String?               @db.Text
  javascript          String?               @db.Text
  hasHtml             Boolean               @default(false)
  hasCss              Boolean               @default(false)
  hasJavaScript       Boolean               @default(false)
  isComplete          Boolean               @default(false)
  jsValid             Boolean               @default(false)
  jsError             String?
  validationScore     Int                   @default(0)
  validationPassed    Boolean               @default(false)
  validationErrors    Json                  @default("[]")
  validationWarnings  Json                  @default("[]")
  cspViolations       Json                  @default("[]")
  generationType      String                @default("webapp")
  retryCount          Int                   @default(0)
  generationTime      Int                   @default(0)
  tokensUsed          Int                   @default(0)
  lastModified        DateTime              @default(now())
  
  // Relations
  ApiEndpoint         ApiEndpoint[]
  CustomDomain        CustomDomain[]
  DatabaseConnection  DatabaseConnection?
  Deployment          Deployment[]
  EnvironmentVariable EnvironmentVariable[]
  FormSubmission      FormSubmission[]
  Page                Page[]
  User                User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  ProjectShare        ProjectShare[]
  ProjectVersion      ProjectVersion[]

  @@index([isPublic])
  @@index([isPublished])
  @@index([publicSlug])
  @@index([shareToken])
  @@index([updatedAt])
  @@index([userId])
  @@index([userId, updatedAt])
  @@index([status])
  @@index([validationScore])
  @@index([createdAt])
  @@schema("public")
}

model ProjectShare {
  id        String   @id @default(cuid())
  projectId  String
  sharedWith String
  permission String    @default("view")
  createdAt  DateTime  @default(now())
  expiresAt  DateTime?
  Project    Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  User       User      @relation(fields: [sharedWith], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([sharedWith])
  @@schema("public")
}

model ProjectVersion {
  id        String   @id @default(cuid())
  projectId   String
  version     Int
  code        String
  description String?
  createdAt   DateTime @default(now())
  userId      String?
  Project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  User        User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([projectId])
  @@index([userId])
  @@schema("public")
}

model SecurityEvent {
  id        String   @id @default(cuid())
  userId    String?
  type      String
  ipAddress String?
  userAgent String?
  metadata  Json?
  severity  String
  createdAt DateTime @default(now())
  action    String   @default("success")
  location  String?
  User      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([severity, createdAt])
  @@index([type, createdAt])
  @@index([userId, createdAt])
  @@schema("public")
}

model Session {
  id        String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  createdAt    DateTime @default(now())
  ipAddress    String?
  lastActive   DateTime @default(now())
  userAgent    String?
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([sessionToken])
  @@index([userId])
  @@index([userId, lastActive])
  @@schema("public")
}

model Subscription {
  id        String   @id @default(cuid())
  userId               String    @unique
  stripeCustomerId     String?   @unique
  stripeSubscriptionId String?   @unique
  stripePriceId        String?
  plan                 String    @default("free")
  status               String    @default("active")
  createdAt            DateTime  @default(now())
  updatedAt DateTime @updatedAt
  cancelAtPeriodEnd    Boolean   @default(false)
  currentPeriodEnd     DateTime?
  currentPeriodStart   DateTime  @default(now())
  User                 User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([stripeCustomerId])
  @@index([stripeSubscriptionId])
  @@index([userId])
  @@schema("public")
}

model Template {
  id        String   @id @default(cuid())
  name             String
  description      String
  tier             TemplateTier       @default(FREE)
  price            Float              @default(0)
  status           TemplateStatus     @default(DRAFT)
  thumbnail        String?
  category         String
  tags             String[]           @default([])
  downloads        Int                @default(0)
  views            Int                @default(0)
  rating           Float              @default(0)
  reviewCount      Int                @default(0)
  creatorId        String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime @updatedAt           @default(now())
  cssCode          String?
  htmlCode         String
  jsCode           String?
  User             User               @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  TemplatePurchase TemplatePurchase[]
  TemplateRevenue  TemplateRevenue[]
  TemplateReview   TemplateReview[]

  @@index([category])
  @@index([creatorId])
  @@index([status])
  @@index([tier])
  @@schema("public")
}

model TemplatePurchase {
  id        String   @id @default(cuid())
  templateId  String
  userId      String
  price       Float
  purchasedAt DateTime @default(now())
  Template    Template @relation(fields: [templateId], references: [id], onDelete: Cascade)
  User        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([templateId, userId])
  @@index([templateId])
  @@index([userId])
  @@schema("public")
}

model TemplateRevenue {
  id        String   @id @default(cuid())
  templateId      String
  creatorId       String
  creatorShare    Float
  platformShare   Float
  amount          Float
  createdAt       DateTime  @default(now())
  paidOut         Boolean   @default(false)
  paidOutAt       DateTime?
  stripePaymentId String?
  User            User      @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  Template        Template  @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@index([creatorId])
  @@index([paidOut])
  @@index([templateId])
  @@schema("public")
}

model TemplateReview {
  id        String   @id @default(cuid())
  templateId String
  userId     String
  rating     Int
  comment    String?
  createdAt  DateTime @default(now())
  updatedAt DateTime @updatedAt
  Template   Template @relation(fields: [templateId], references: [id], onDelete: Cascade)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([templateId, userId])
  @@index([templateId])
  @@index([userId])
  @@schema("public")
}

model User {
  id        String   @id @default(cuid())
  name                  String?
  email                 String                 @unique
  emailVerified         DateTime?
  password              String?
  image                 String?
  createdAt             DateTime               @default(now())
  updatedAt DateTime @updatedAt
  autoSave              Boolean                @default(true)
  notifications         Boolean                @default(true)
  theme                 String                 @default("dark")
  bio                   String?
  promoCodeUsed         String?
  discountRate          Float                  @default(0)
  subscriptionTier      String                 @default("free")
  subscriptionStatus    String                 @default("active")
  stripeCustomerId      String?                @unique
  stripeSubscriptionId  String?                @unique
  subscriptionResetDate DateTime?
  cancelAtPeriodEnd     Boolean                @default(false)
  currentPeriodStart    DateTime?
  currentPeriodEnd      DateTime?
  generationsUsed       Int                    @default(0)
  generationsLimit      Int                    @default(10)
  projectsThisMonth     Int                    @default(0)
  projectsLimit         Int                    @default(3)
  role                  String                 @default("user")
  githubAccessToken     String?
  githubUsername        String?
  twoFactorEnabled      Boolean                @default(false)
  twoFactorSecret       String?
  resetToken            String?                @unique
  resetTokenExpiry      DateTime?
  vercelToken           String?
  vercelProjectName     String?
  vercelTeamId          String?
  accountLockedUntil    DateTime?
  failedLoginAttempts   Int                    @default(0)
  lastLoginAt           DateTime?
  lastLoginIp           String?
  twoFactorBackupCodes  String[]               @default([])
  hasSeenOnboarding     Boolean                @default(false)
  
  // Relations
  Account               Account[]
  ActiveSession         ActiveSession[]
  Activity              Activity[]
  CustomDomain          CustomDomain[]
  DatabaseConnection    DatabaseConnection[]
  Deployment            Deployment[]
  DripEnrollment        DripEnrollment[]
  EmailCampaign         EmailCampaign[]
  Feedback              Feedback[]
  FormSubmission        FormSubmission[]
  Generation            Generation[]
  GenerationHistory     GenerationHistory[]
  NewsletterSubscriber  NewsletterSubscriber[]
  PasswordHistory       PasswordHistory[]
  Project               Project[]
  ProjectShare          ProjectShare[]
  ProjectVersion        ProjectVersion[]
  SecurityEvent         SecurityEvent[]
  Session               Session[]
  Subscription          Subscription?
  Template              Template[]
  TemplatePurchase      TemplatePurchase[]
  TemplateRevenue       TemplateRevenue[]
  TemplateReview        TemplateReview[]
  VercelConnection      VercelConnection?
  WorkspaceMember       WorkspaceMember[]

  @@schema("public")
}

model VercelConnection {
  id        String   @id @default(cuid())
  userId          String   @unique
  accessToken     String
  refreshToken    String?
  teamId          String?
  configurationId String?
  username        String?
  email           String?
  connectedAt     DateTime @default(now())
  updatedAt DateTime @updatedAt
  User            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@schema("public")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@schema("public")
}

model Workspace {
  id        String   @id @default(cuid())
  name                 String
  slug                 String             @unique
  description          String?
  createdAt            DateTime           @default(now())
  updatedAt DateTime @updatedAt
  subscriptionTier     String             @default("free")
  subscriptionStatus   String             @default("active")
  stripeCustomerId     String?            @unique
  stripeSubscriptionId String?            @unique
  currentPeriodStart   DateTime?
  currentPeriodEnd     DateTime?
  generationsUsed      Int                @default(0)
  generationsLimit     Int                @default(50)
  projectsLimit        Int                @default(10)
  membersLimit         Int                @default(5)
  WorkspaceInvite      WorkspaceInvite[]
  WorkspaceMember      WorkspaceMember[]
  WorkspaceProject     WorkspaceProject[]

  @@index([slug])
  @@index([stripeCustomerId])
  @@index([stripeSubscriptionId])
  @@schema("public")
}

model WorkspaceInvite {
  id        String   @id @default(cuid())
  workspaceId String
  email       String
  role        String    @default("member")
  token       String    @unique
  status      String    @default("pending")
  invitedBy   String
  createdAt   DateTime  @default(now())
  expiresAt   DateTime
  acceptedAt  DateTime?
  Workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([status])
  @@index([token])
  @@index([workspaceId])
  @@schema("public")
}

model WorkspaceMember {
  id        String   @id @default(cuid())
  workspaceId String
  userId      String
  role        String    @default("member")
  joinedAt    DateTime  @default(now())
  updatedAt DateTime @updatedAt
  User        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  Workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, userId])
  @@index([role])
  @@index([userId])
  @@index([workspaceId])
  @@schema("public")
}

model WorkspaceProject {
  id        String   @id @default(cuid())
  workspaceId String
  projectId   String
  permission  String    @default("edit")
  addedAt     DateTime  @default(now())
  addedBy     String?
  Workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, projectId])
  @@index([projectId])
  @@index([workspaceId])
  @@schema("public")
}

model promo_codes {
  id        String   @id @default(cuid())
  code          String    @unique
  discountType  String
  discountValue Int
  maxUses       Int
  timesUsed     Int       @default(0)
  validUntil    DateTime?
  applicableTo  String[]  @default([])
  active        Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt DateTime @updatedAt

  @@index([active], map: "idx_promo_codes_active")
  @@index([code])
  @@schema("public")
}

// ============================================================================
// ENUMS
// ============================================================================

enum ProjectStatus {
  DRAFT
  GENERATING
  COMPLETED
  INCOMPLETE
  FAILED
  PUBLISHED

  @@schema("public")
}

enum TemplateStatus {
  DRAFT
  PUBLISHED
  ARCHIVED

  @@schema("public")
}

enum TemplateTier {
  FREE
  PRO
  COLLECTION

  @@schema("public")
}
